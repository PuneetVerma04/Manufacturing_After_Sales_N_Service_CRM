<template>
    <lightning-card title="My Service Cases" icon-name="standard:case">
        <div class="slds-p-around_medium">
            <!-- Case Filters -->
            <div class="slds-box slds-theme_shade slds-m-bottom_medium">
                <div class="slds-grid slds-wrap slds-gutters">
                    <div class="slds-col slds-size_1-of-3">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Status Filter:</label>
                            <div class="slds-form-element__control">
                                <select class="slds-select" onchange={handleStatusFilter}>
                                    <option value="">All Statuses</option>
                                    <option value="New">New</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Waiting for Customer">Waiting for Customer</option>
                                    <option value="Resolved">Resolved</option>
                                    <option value="Closed">Closed</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size_1-of-3">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Priority Filter:</label>
                            <div class="slds-form-element__control">
                                <select class="slds-select" onchange={handlePriorityFilter}>
                                    <option value="">All Priorities</option>
                                    <option value="High">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="slds-col slds-size_1-of-3">
                        <div class="slds-form-element">
                            <label class="slds-form-element__label">Actions:</label>
                            <div class="slds-form-element__control">
                                <lightning-button-group>
                                    <lightning-button label="New Request" onclick={createNewRequest} 
                                                    variant="brand" icon-name="utility:add"></lightning-button>
                                    <lightning-button label="Submit Feedback" onclick={navigateToFeedback} 
                                                    variant="neutral" icon-name="utility:feedback"></lightning-button>
                                </lightning-button-group>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cases Table -->
            <div class="slds-box">
                <template if:true={myCases}>
                    <template if:true={myCases.length}>
                        <div class="slds-scrollable_y">
                            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                                <thead>
                                    <tr class="slds-line-height_reset">
                                        <th class="slds-text-title_caps">Case Number</th>
                                        <th class="slds-text-title_caps">Subject</th>
                                        <th class="slds-text-title_caps">Status</th>
                                        <th class="slds-text-title_caps">Priority</th>
                                        <th class="slds-text-title_caps">Engineer</th>
                                        <th class="slds-text-title_caps">Created Date</th>
                                        <th class="slds-text-title_caps">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={myCases} for:item="caseItem">
                                        <tr key={caseItem.Id} class={caseItem.statusClass}>
                                            <td data-label="Case Number">
                                                <a href={caseItem.caseUrl} target="_blank">{caseItem.Name}</a>
                                            </td>
                                            <td data-label="Subject">{caseItem.Subject__c}</td>
                                            <td data-label="Status">
                                                <span class={caseItem.statusBadge}>{caseItem.Status__c}</span>
                                            </td>
                                            <td data-label="Priority">
                                                <span class={caseItem.priorityBadge}>{caseItem.Priority__c}</span>
                                            </td>
                                            <td data-label="Engineer">
                                                {caseItem.Engineer_Assigned__r.Name}
                                            </td>
                                            <td data-label="Created Date">{caseItem.createdDateFormatted}</td>
                                            <td data-label="Actions">
                                                <lightning-button-group>
                                                    <lightning-button label="View" onclick={viewCase} 
                                                                    data-case-id={caseItem.Id} variant="neutral" 
                                                                    size="small"></lightning-button>
                                                    <template if:true={caseItem.canSubmitFeedback}>
                                                        <lightning-button label="Feedback" onclick={submitFeedback} 
                                                                        data-case-id={caseItem.Id} variant="brand" 
                                                                        size="small"></lightning-button>
                                                    </template>
                                                </lightning-button-group>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </template>
                    <template if:false={myCases.length}>
                        <div class="slds-text-align_center slds-p-vertical_large">
                            <p>No service cases found.</p>
                            <lightning-button label="Create New Service Request" onclick={createNewRequest} 
                                            variant="brand" class="slds-m-top_medium"></lightning-button>
                        </div>
                    </template>
                </template>
            </div>
        </div>
    </lightning-card>
</template>
